<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />

    <!-- Viewport stabil + no-zoom + aman notch -->
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1, user-scalable=no, interactive-widget=overlays-content"
    />

    <!-- Matikan caching level dokumen -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <meta name="format-detection" content="telephone=no" />
    <meta name="theme-color" content="#0B0B12" />
    <title>Cyber Runner X</title>

    <style>
      /* ===== Bekukan viewport & pindahkan scroll ke #root (anti auto-zoom) ===== */
      :root { --app-vh: 100svh; }
      html, body { height: var(--app-vh); min-height: var(--app-vh); }
      body {
        margin: 0;
        background: #0B0B12;
        height: var(--app-vh);
        min-height: var(--app-vh);
        overflow: hidden;             /* <— kunci scroll di body */
        overscroll-behavior-y: none;
        -webkit-font-smoothing: antialiased;
      }
      #root{
        position: fixed; inset: 0;
        height: 100%; min-height: 100%;
        overflow: auto;               /* <— scroll di sini */
        -webkit-overflow-scrolling: touch;
      }
      * { -webkit-tap-highlight-color: transparent; }
    </style>

    <script>
      // 1) Bekukan tinggi viewport agar address bar tidak memicu "zoom"
      (function () {
        function freezeVH() {
          const vv = window.visualViewport;
          const h = vv ? Math.round(vv.height) : window.innerHeight;
          document.documentElement.style.setProperty('--app-vh', h + 'px');
          document.body && (document.body.style.height = h + 'px');
        }
        freezeVH();
        window.addEventListener('orientationchange', () => setTimeout(freezeVH, 250), { passive: true });
        window.addEventListener('pageshow', () => setTimeout(freezeVH, 150), { passive: true });
      })();

      // 2) Saring resize yang cuma ubah tinggi (efek address bar)
      (function () {
        let lastW = window.innerWidth || document.documentElement.clientWidth;
        window.addEventListener('resize', function (e) {
          const w = window.innerWidth || document.documentElement.clientWidth;
          if (Math.abs(w - lastW) < 2) {
            e.stopImmediatePropagation && e.stopImmediatePropagation();
            return;
          }
          lastW = w;
        }, true);
      })();

      // 3) Cegah pinch/double-tap zoom
      (function () {
        const prevent = e => { e.preventDefault(); };
        document.addEventListener('gesturestart', prevent, { passive: false });
        document.addEventListener('wheel', e => { if (e.ctrlKey) e.preventDefault(); }, { passive: false });
        let lastTouch = 0;
        document.addEventListener('touchend', e => {
          const now = Date.now();
          if (now - lastTouch < 300) e.preventDefault();
          lastTouch = now;
        }, { passive: false });
      })();

      // 4) iOS: paksa auth jadi full-page redirect (bypass popup blocker/ITP)
      (function () {
        const ua = navigator.userAgent || '';
        const isIOS = /iP(hone|od|ad)/.test(ua);
        if (!isIOS) return;
        const originalOpen = window.open;
        window.open = function (url) {
          try {
            if (typeof url === 'string' && /(privy|auth|login|connect|wallet)/i.test(url)) {
              location.href = url; return null;
            }
          } catch (_) {}
          return originalOpen ? originalOpen.apply(window, arguments) : null;
        };
      })();

      // 5) Unregister service worker lama (hindari JS lama yang bikin data “hilang”)
      (function () {
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(rs => rs.forEach(r => r.unregister())).catch(()=>{});
        }
      })();
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
